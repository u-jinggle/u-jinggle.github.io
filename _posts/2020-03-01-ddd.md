---
title: "DDD란 무엇일까"
layout: post
subtitle: 'DDD?'
author: "Ujin"
header-style: text
tags:
  - DDD
  - Spring
---
    

최근 POST들을 보면 눈치 챘겠지만, 나는 지금 Spring을 처음 시작하는 개발자이다.  
개념을 얼추?익히고 간단한 프로젝트를 시작하는 중이었고 흔히들 사용하는 Controller-Service-DAO-DTO 패턴을 적용시켰다.  
(기존 PHP에서 사용하던 Codeigniter와도 비슷한 패턴을 사용했기 때문에 익숙했다 ㅋㅋ)

그러데 프로젝트를 진행하던 중 파트장님이 DDD를 사용해 보는건 어때? 라는 제안을 해주셨다 ㅎ
간단한 블로그를 참조한후 설계를 진행해 보았지만..
공부좀 더해와~ 라는 피드백을 받았고.. 기왕 이렇게 된거 제대로 공부해 보기로 하여 책을 집어 들었다  

## DDD란?  
도메인 주도 설계(Domain Driven Design)의 약자로, 

## Domain Model
도메인 모델은 특정 도메인을 개념적으로 표현한 것을 의미한다.
- 객체를 이용한 도메인 모델
- 다이어그램을 이용한 도메인 모델

...
이렇게 도출된 모델은 크게 Entity와 Value로 구분될 수 있다.

## Entity
'식별자를 갖는다'라는 것이 가장 큰 특징이다.  
주문 도메인의 각 주문은 주문번호를 통해 각각 구분될 수 있다.
따라서 주문에 해당하는 Order class는 Entity이며 주문번호를 속성으로 가진다.

또한 식별자는 바뀌지 않는다.
식별자가 같은 Entity는 같은 Entity 인 것이다.

### Entity의 식별자 생성 방법
- 특정 규책에 따라 생성
- UUID 사용
- 값을 직접 입력
- 일련번호 사용(시퀀스나 DB의 자동증가 칼럼 사용)

## Value
개념적으로 완전한 하나를 표현할 때 사용한다.



## Service
응용영역에 해당하는 Service에는 사용자에게 제공할 기능을 구현한다.  
하지만 Service단에 로직을 직접 구현하기 보다는 도메인 모델에 로직 수행을 위임하는 역할을 수행한다.

![Service-Domain](/img/in-post/2020-03-01/2020-03-01_1.png){: width="80%"} 


...p44
Infrastructure영역에 의존하면 '테스트 어려움'과 '기능 확장의 어려움'이 발생 될 수 있다.
해결을 위해 DIP를 적용하면 된다고 하는데 DIP란 무엇일까?

## DIP

...

![structure](/img/in-post/2020-03-01/2020-03-01_3.png){: width="80%"} 


## 도메인 영역의 주요 구성요소  

### Entity
- 고유의 식별자를 갖는 객체로 자신만의 LifeCycle을 갖는다.   
- 고유한 개념을 표현한다.  
- 도메인 모델의 데이터를 포함하며 해당 데이터와 관련된 기능을 함꼐 제공한다.  

### Value
- 고유한 식별자를 갖지 않는 객체로 주로 개념적으로 하나인 도메인 객체의 속성을 표현할 때 사용된다.  
- Entity의 속성뿐만 아니라 다른 Value타입의 속성으로도 사용될 수 있다.  

### Aggregate
- 관련된 Entity와 Value객체를 개념적으로 하나로 묶은 것이다.  
- Aggregate 군집에 속한 객체들을 관리하기 위한 Root Entity를 갖는다.    
- Root Entity는 해당 Aggregate내에 속해 있는 Entity와 Value를 이용해서 기능을 제공하는 역할을 한다.  
- 또한 Aggregate를 통해서만 해당 Entity와 Value에 접근이 가능하기 때문에 기능을 캡슐화 할 수 있다.  

### Repository
- 도메인 모델의 영속성을 처리한다.  
- 예를 들어, DBMS테이블에서 Entity객체를 로딩하거나 저장하는 기능을 제공한다.  
- Aggregate 단위로 도메인 객체를 저장하고 조회하는 기능을 정의한다.  
- Repository 인터페이스는 도메인 모델 영역에 속하며, 실제 구현 클래스는 Infra Structure영역에 속한다.  
![Repository](/img/in-post/2020-03-01/2020-03-01_2.png){: width="80%"} 

### Domain Service
- 특정 Entity에 속하지 않은 도메인 로직을 제공한다.  
- 도메인 로직이 여러 Entity와 Value를 필요로 할 경우 도메인 서비스에서 로직을 구현한다.  

도메인 모델의 Entity와 DB테이블의 Entity는 다르다.  
가장 큰 차이점으로 도메인 모델의 Entity는 다순히 데이터를 담는 구조로 끝나지 않고 기능도 제공한다는 점이다.  
도메인 관점에서 기능을 제공하며 기능 구현을 캡슐화해서 데이터가 임의로 변경 되는 것을 막는다.  



## Aggregate  
복잡한 객체를 Aggregate로 묶어 바라보면 상위 수준에서 도메인 모델간의 관계를 파악할 수 있다.  
한 Aggregate에 속한 객체는 다른 Aggregate에 속하지 않는다.  
Aggregate는 독립된 객체 군으로 자신만을 관리할 뿐 다른 Aggregate를 관리하지 않는다.  
Aggregate에 속한 모든 객체가 일관된 상태를 유지하려면 Aggregate 전체를 관리할 주체가 필요한데 이책임을 지는 것이 바로 Aggregate Root Entity이다.  
Aggregate Root Entity는 Aggregate의 대표 Entity로 Aggregate에 속한 객체는 Aggregate Root Entity의 직접 또는 간접적으로 속한다.  

### Aggregate Root Entity
Aggregate Root Entity의 핵심 역할은 Aggregate의 일관성이 꺠지지 않도록 하는 것이다.  
이를 위해 Aggregate Root Entity는 Aggregate가 제공해야 할 도메인 기능을 구현한다.  
또한 Aggregate Root가 아닌 다른 객체가 Aggregate에 속한 객체를 직접 변경하면 안된다.  
불필요한 중복을 피하고 Aggregate Root를 통해서만 도메인 로직을 구현하게 만들려면 도메인 모델에 대해 두가지 원칙이 필요하다.  
    - 단순히 필드를 변경하는 set method를 공개 (public) 범위로 만들지 않는다.
        -> 도메인 로직이 도메인 객체가 아닌 응응 영역이나 표현영역으로 분산되게 만드는 원인이 된다. 
    - Value 타입은 불변으로 구현한다.  
        -> Value객체가 불변이면, 새로운 Value객체를 할당하는 방법을 통해 Value객체의 값을 변경해야만 한다.  